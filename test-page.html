<!DOCTYPE html>
<html>
<head>
    <title>Schedule Generation Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Schedule Generation Test</h1>
    
    <button onclick="testBasicGeneration()">Test Basic Generation</button>
    <button onclick="testWithMockData()">Test With Mock Data</button>
    <button onclick="checkCurrentPage()">Check Current Page</button>
    
    <div id="results"></div>
    
    <script>
        function log(message) {
            console.log(message);
            const results = document.getElementById('results');
            results.innerHTML += '<div class="result">' + message + '</div>';
        }
        
        function testBasicGeneration() {
            log('🧪 Testing basic generation...');
            
            // Simple test data
            const mockProfiles = [
                { id: 'emp1', first_name: 'Anna', last_name: 'Test', role: 'Sjuksköterska', experience_level: 3 },
                { id: 'emp2', first_name: 'Erik', last_name: 'Test', role: 'Undersköterska', experience_level: 2 }
            ];
            
            const mockSettings = {
                max_consecutive_days: 5,
                min_rest_hours: 11,
                department: 'General',
                morning_shift: { min_staff: 2, min_experience_sum: 4 },
                afternoon_shift: { min_staff: 2, min_experience_sum: 4 },
                night_shift: { min_staff: 1, min_experience_sum: 2 }
            };
            
            log('✅ Mock data created successfully');
            log('📊 Profiles: ' + mockProfiles.length);
            log('📊 Settings: ' + JSON.stringify(mockSettings, null, 2));
        }
        
        function testWithMockData() {
            log('🧪 Testing with mock data from application...');
            
            // Try to access the application's data
            try {
                if (window.opener && window.opener.location.href.includes('localhost')) {
                    log('🔗 Found parent application window');
                    
                    // Try to access React components
                    const parentDoc = window.opener.document;
                    const buttons = Array.from(parentDoc.querySelectorAll('button'));
                    const generateButton = buttons.find(btn => btn.textContent?.includes('Generera schema'));
                    
                    if (generateButton) {
                        log('🎯 Found generate button in parent: ' + generateButton.textContent);
                        log('🔍 Button disabled: ' + generateButton.disabled);
                        log('🔍 Button classes: ' + generateButton.className);
                    } else {
                        log('❌ Generate button not found in parent');
                    }
                    
                } else {
                    log('❌ No parent application window found');
                }
            } catch (error) {
                log('❌ Error accessing parent: ' + error.message);
            }
        }
        
        function checkCurrentPage() {
            log('🔍 Checking current application page...');
            
            // Open the main application
            const appWindow = window.open('http://localhost:8082', '_blank');
            
            setTimeout(() => {
                try {
                    const buttons = Array.from(appWindow.document.querySelectorAll('button'));
                    const generateButton = buttons.find(btn => btn.textContent?.includes('Generera schema'));
                    
                    if (generateButton) {
                        log('✅ Found generate button');
                        log('🔍 Disabled: ' + generateButton.disabled);
                        log('🔍 Classes: ' + generateButton.className);
                        
                        // Try to click it
                        log('🖱️ Attempting to click button...');
                        generateButton.click();
                        log('✅ Click event sent');
                    } else {
                        log('❌ Generate button not found');
                        log('📋 Available buttons: ' + buttons.map(btn => btn.textContent).join(', '));
                    }
                } catch (error) {
                    log('❌ Error: ' + error.message);
                }
            }, 2000);
        }
        
        log('🚀 Test page loaded. Click buttons to run tests.');
    </script>
</body>
</html>
